# PRE-SIGNED ONLY MODE

## Обзор

Эта игра настроена для использования **ТОЛЬКО предварительно подписанных (pre-signed) транзакций**. Realtime подписание транзакций отключено для максимальной производительности и предсказуемости.

## Ключевые изменения

### 1. Отключены Realtime транзакции
- Функция `createRealtimeTransaction` отключена
- Все fallback механизмы на realtime подписание удалены
- Игра работает исключительно с pre-signed пулом транзакций

### 2. Увеличены размеры пулов транзакций
```javascript
const ENHANCED_POOL_CONFIG = {
  6342: { // MegaETH
    poolSize: 100,     // Было: 30
    refillAt: 0.2,     // Было: 0.3
    batchSize: 25,     // Было: 12
  },
  default: {
    poolSize: 60,      // Было: 15
    refillAt: 0.3,     // Было: 0.5
    batchSize: 15,     // Было: 8
  }
}
```

### 3. Проактивный мониторинг пула
- Автоматический мониторинг каждые 2 секунды
- Критические предупреждения при остатке ≤5 транзакций
- Предупреждения при остатке ≤15 транзакций
- Экстренное пополнение пула при критическом уровне

### 4. Экстренная обработка ошибок
- При исчерпании пула - попытка экстренного пополнения
- Минимальный размер экстренного пакета: 5 транзакций
- Детальное логирование всех критических ситуаций

### 5. Обновленный UI
- Отображение статуса пула: `Pool: 45/100`
- Цветовая индикация:
  - 🟢 Зеленый: >15 транзакций
  - 🟡 Оранжевый: 5-15 транзакций  
  - 🔴 Красный: <5 транзакций
- Индикаторы состояния: `⏳ Preparing...`, `🔄 Refilling...`

## Файлы изменений

### `src/hooks/useBlockchainUtils.js`
- ❌ Отключен `createRealtimeTransaction`
- ❌ Удален fallback на realtime в `getNextTransaction`
- ✅ Добавлен экстренный refill механизм
- ✅ Добавлен проактивный мониторинг `startPoolMonitoring`
- ✅ Увеличены размеры пулов
- ✅ Добавлен `getPoolStatus` для UI

### `src/services/blockchainService.js`
- 🔄 Полностью переписан для использования pre-signed транзакций
- ❌ Удалена зависимость от ethers.js
- ✅ Интегрирован с `useBlockchainUtils`

### `src/components/GameComponent.jsx`
- ✅ Добавлен `getPoolStatus` из хука
- ✅ Добавлено отслеживание `poolStatus` в состоянии

### `src/game/Score.js`
- ✅ Добавлено отображение статуса пула
- ✅ Цветовая индикация уровня транзакций
- ✅ Индикаторы состояния пула

## Мониторинг и отладка

### Консольные команды
```javascript
// Статус пула для конкретной сети
window.blockchainDebug.quickStats(6342)

// Полный отчет по производительности
window.blockchainDebug.generatePerformanceReport(6342)

// Сброс circuit breakers
window.blockchainDebug.forceResetAllCircuitBreakers()
```

### Ключевые логи
- 🎮 `First transaction ready - gaming can begin!` - Пул готов
- 👁️ `Started proactive pool monitoring` - Мониторинг запущен
- ⚠️ `WARNING: Only X transactions left` - Предупреждение
- 🚨 `CRITICAL: Only X transactions left` - Критический уровень
- 🚨 `Emergency pre-signing X transactions` - Экстренное пополнение

## Преимущества Pre-signed Only режима

1. **Предсказуемая производительность** - Нет задержек на подписание
2. **Максимальная скорость** - Транзакции готовы мгновенно
3. **Стабильность** - Нет зависимости от кошелька в runtime
4. **Масштабируемость** - Пул можно пополнять фоново
5. **Real-time gaming** - Идеально для игр реального времени

## Потенциальные риски

1. **Исчерпание пула** - Если пул не пополняется достаточно быстро
2. **Nonce конфликты** - При параллельном использовании кошелька
3. **Память** - Большие пулы занимают больше памяти

## Рекомендации

1. Мониторить логи на предмет предупреждений о низком уровне
2. При высокой нагрузке увеличить `poolSize` в конфигурации
3. Использовать отдельный кошелек только для игры
4. Регулярно проверять `window.blockchainDebug.quickStats(chainId)`